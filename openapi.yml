openapi: 3.0.3
info:
  title: Easyapp API
  version: 1.0.0
  description: API documentation for easyapp
paths:
  /api/hello/:
    get:
      operationId: api_hello_retrieve
      description: Get a hello world message
      tags:
        - api
      security:
        - cookieAuth: []
        - basicAuth: []
        - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
          description: ''
  # ... existing path definitions ...
  /api/test/simulate-business-model/:
    post:
      operationId: test_simulate_business_model_create
      summary: 'Тестовый: симуляция бизнес-модели с инфлюенсерами'
      description: 'Админский эндпоинт, который детерминированно создаёт трёх инфлюенсеров и сто приглашённых игроков, прогоняет пополнения через process_member_deposit и кошелёк, после чего возвращает подробную аналитику по каждому инфлюенсеру и глобальные итоги.'
      tags:
        - test
      security:
        - MemberTokenAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessSimulationRequest'
      responses:
        '200':
          description: 'Результат симуляции бизнес-модели.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessSimulationResponse'
        '401':
          description: Требуется аутентификация
        '403':
          description: Доступ запрещён
components:
  schemas:
    Message:
      type: object
      properties:
        message:
          type: string
          maxLength: 200
        timestamp:
          type: string
          format: date-time
          readOnly: true
      required:
        - message
        - timestamp
    # ... existing schema definitions ...
    BusinessSimulationRequest:
      type: object
      description: 'Опциональные параметры для симуляции бизнес-модели.'
      properties:
        seed:
          type: integer
          minimum: 1
          description: 'Детерминированный seed. По умолчанию 2024.'
      required: []
    BusinessSimulationPlayer:
      type: object
      description: 'Финансовый срез по игроку, созданному в симуляции.'
      properties:
        member_id:
          type: integer
        phone:
          type: string
        influencer_id:
          type: integer
        deposit_amount:
          type: string
          format: decimal
        spend_amount:
          type: string
          format: decimal
        wallet_balance:
          type: string
          format: decimal
      required:
        - member_id
        - phone
        - influencer_id
        - deposit_amount
        - spend_amount
        - wallet_balance
    BusinessSimulationInfluencer:
      type: object
      description: 'Метрики по инфлюенсеру-участнику симуляции.'
      properties:
        member_id:
          type: integer
        name:
          type: string
        phone:
          type: string
        players_count:
          type: integer
        active_players:
          type: integer
        total_deposit_volume:
          type: string
          format: decimal
        total_spend_volume:
          type: string
          format: decimal
        referral_reward_volume:
          type: string
          format: decimal
        wallet_balance:
          type: string
          format: decimal
      required:
        - member_id
        - name
        - phone
        - players_count
        - active_players
        - total_deposit_volume
        - total_spend_volume
        - referral_reward_volume
        - wallet_balance
    BusinessSimulationGlobalMetrics:
      type: object
      description: 'Глобальные агрегаты по симуляции.'
      properties:
        total_influencers:
          type: integer
        total_players:
          type: integer
        total_deposit_volume:
          type: string
          format: decimal
        total_spend_volume:
          type: string
          format: decimal
        total_referral_rewards:
          type: string
          format: decimal
        total_active_referrals:
          type: integer
      required:
        - total_influencers
        - total_players
        - total_deposit_volume
        - total_spend_volume
        - total_referral_rewards
        - total_active_referrals
    BusinessSimulationCounters:
      type: object
      description: 'Технические счётчики созданных сущностей.'
      properties:
        new_influencers:
          type: integer
        new_players:
          type: integer
        new_referral_events:
          type: integer
        new_wallet_deposits:
          type: integer
        new_wallet_spends:
          type: integer
      required:
        - new_influencers
        - new_players
        - new_referral_events
        - new_wallet_deposits
        - new_wallet_spends
    BusinessSimulationResponse:
      type: object
      description: 'Ответ симуляции бизнес-модели.'
      properties:
        scenario_tag:
          type: string
        influencers:
          type: array
          items:
            $ref: '#/components/schemas/BusinessSimulationInfluencer'
        players:
          type: array
          items:
            $ref: '#/components/schemas/BusinessSimulationPlayer'
        global_metrics:
          $ref: '#/components/schemas/BusinessSimulationGlobalMetrics'
        counters:
          $ref: '#/components/schemas/BusinessSimulationCounters'
      required:
        - scenario_tag
        - influencers
        - players
        - global_metrics
        - counters
