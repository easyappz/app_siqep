openapi: 3.0.3
info:
  title: Easyapp API
  version: 1.0.0
  description: API documentation for easyapp
paths:
  /api/hello/:
    get:
      operationId: api_hello_retrieve
      description: Get a hello world message
      tags:
        - api
      security:
        - cookieAuth: []
        - basicAuth: []
        - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
          description: ''
  /api/auth/register/:
    post:
      operationId: auth_register_create
      description: 'Регистрация нового пользователя по номеру телефона с опциональным реферальным кодом. При наличии реферального кода создаются связи в ранговой реферальной системе, а финансовые бонусы начисляются после первого турнира/депозита нового игрока.'
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegistrationRequest'
      responses:
        '201':
          description: Успешная регистрация
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegistrationResponse'
        '400':
          description: Ошибка валидации данных регистрации
  /api/auth/login/:
    post:
      operationId: auth_login_create
      description: 'Авторизация пользователя по номеру телефона и паролю.'
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Успешная авторизация
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Ошибка валидации данных авторизации
  /api/auth/me/:
    get:
      operationId: auth_me_retrieve
      description: 'Получить профиль текущего авторизованного пользователя.'
      tags:
        - auth
      security:
        - MemberTokenAuth: []
      responses:
        '200':
          description: Профиль пользователя
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Member'
        '401':
          description: Требуется аутентификация
    patch:
      operationId: auth_me_partial_update
      description: 'Обновить профиль текущего пользователя: имя, фамилию, email и реквизиты для вывода средств.'
      tags:
        - auth
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MeUpdateRequest'
      responses:
        '200':
          description: 'Обновлённый профиль пользователя.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Member'
        '400':
          description: 'Ошибка валидации данных.'
        '401':
          description: 'Требуется аутентификация.'
  /api/auth/change-password/:
    post:
      operationId: auth_change_password_create
      description: 'Сменить пароль текущего авторизованного пользователя.'
      tags:
        - auth
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: 'Пароль успешно изменён.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChangePasswordResponse'
        '400':
          description: 'Ошибка валидации данных (например, неверный текущий пароль или слишком короткий новый пароль).'
        '401':
          description: 'Требуется аутентификация.'
  /api/auth/password-reset/request/:
    post:
      operationId: auth_password_reset_request_create
      description: 'Запросить одноразовый код для сброса пароля по email или телефону.'
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetRequestRequest'
      responses:
        '200':
          description: 'Код для смены пароля отправлен.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetRequestResponse'
        '400':
          description: 'Пользователь с указанными email/телефоном не найден или ошибка валидации.'
  /api/auth/password-reset/confirm/:
    post:
      operationId: auth_password_reset_confirm_create
      description: 'Подтвердить одноразовый код и задать новый пароль.'
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetConfirmRequest'
      responses:
        '200':
          description: 'Пароль успешно сброшен.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PasswordResetConfirmResponse'
        '400':
          description: 'Неверный или просроченный код, пользователь не найден или ошибка валидации.'
  /api/wallet/summary/:
    get:
      operationId: wallet_summary_retrieve
      summary: 'Сводка по кошельку текущего пользователя'
      description: 'Возвращает текущий баланс кошелька и агрегированные суммы пополнений и списаний.'
      tags:
        - wallet
      security:
        - MemberTokenAuth: []
      responses:
        '200':
          description: 'Сводка по кошельку.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletSummary'
        '401':
          description: 'Требуется аутентификация.'
  /api/wallet/transactions/:
    get:
      operationId: wallet_transactions_list
      summary: 'История операций кошелька текущего пользователя'
      description: 'Постраничная история операций кошелька, отсортированная от новых к старым. Можно отфильтровать по типу операции.'
      tags:
        - wallet
      security:
        - MemberTokenAuth: []
      parameters:
        - name: type
          in: query
          required: false
          description: 'Фильтр по типу транзакции кошелька (deposit, spend, withdraw, refund, adjustment, bonus).'
          schema:
            type: string
            enum:
              - deposit
              - spend
              - withdraw
              - refund
              - adjustment
              - bonus
      responses:
        '200':
          description: 'Постраничный список операций кошелька.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedWalletTransactionList'
        '401':
          description: 'Требуется аутентификация.'
  /api/wallet/deposit/:
    post:
      operationId: wallet_deposit_create
      summary: 'Внутреннее пополнение кошелька'
      description: 'Создаёт внутреннюю операцию пополнения кошелька текущего пользователя (без интеграции с платёжными шлюзами).'
      tags:
        - wallet
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WalletDepositRequest'
      responses:
        '201':
          description: 'Операция пополнения кошелька создана.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletTransaction'
        '400':
          description: 'Ошибка валидации данных (например, неположительная сумма).'
        '401':
          description: 'Требуется аутентификация.'
  /api/wallet/spend/:
    post:
      operationId: wallet_spend_create
      summary: 'Списание средств из кошелька'
      description: 'Списывает средства с кошелька текущего пользователя. Этот эндпоинт может вызывать только администратор; обычные участники не могут самостоятельно инициировать списание со своего кошелька. При недостаточном балансе возвращает ошибку 400 с кодом "insufficient_funds".'
      tags:
        - wallet
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WalletSpendRequest'
      responses:
        '201':
          description: 'Операция списания средств успешно создана.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletTransaction'
        '400':
          description: 'Ошибка валидации данных (например, неположительная сумма или недостаточно средств).'
        '401':
          description: 'Требуется аутентификация.'
        '403':
          description: 'Доступ запрещён (только администратор может выполнять списание средств через этот эндпоинт).'
  /api/withdrawal-requests/:
    get:
      operationId: withdrawal_requests_list
      summary: 'Список заявок на вывод текущего пользователя'
      description: 'Возвращает список всех заявок на вывод средств, созданных текущим авторизованным пользователем.'
      tags:
        - withdrawals
      security:
        - MemberTokenAuth: []
      responses:
        '200':
          description: 'Список заявок на вывод.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WithdrawalRequest'
        '401':
          description: Требуется аутентификация
    post:
      operationId: withdrawal_requests_create
      summary: 'Создать заявку на вывод средств'
      description: 'Создаёт новую заявку на вывод средств для текущего пользователя. Сумма не может превышать доступный для вывода баланс инфлюенсерских вознаграждений.'
      tags:
        - withdrawals
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WithdrawalRequestCreateRequest'
      responses:
        '201':
          description: 'Заявка на вывод успешно создана.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WithdrawalRequest'
        '400':
          description: 'Ошибка валидации данных (например, сумма превышает доступный баланс).'
        '401':
          description: Требуется аутентификация
  /api/profile/stats/:
    get:
      operationId: profile_stats_retrieve
      description: 'Получить статистику реферальной программы: количество рефералов, заработанные бонусы и деньги, история начислений, график регистраций и данные о собственных депозитах, а также агрегированные суммы депозитов и бонусов рефералов и сводку по уровням глубины.'
      tags:
        - profile
      security:
        - MemberTokenAuth: []
      responses:
        '200':
          description: Статистика профиля
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileStats'
        '401':
          description: Требуется аутентификация
  /api/referrals/tree/:
    get:
      operationId: referrals_tree_list
      description: 'Получить дерево рефералов текущего пользователя (основанное на ReferralRelation) с указанием глубины, ранга и статуса активации каждого реферала.'
      tags:
        - referrals
      security:
        - MemberTokenAuth: []
      parameters:
        - name: member_id
          in: query
          required: false
          description: 'ID пользователя, для которого нужно получить дерево рефералов (доступно только администраторам).'
          schema:
            type: integer
      responses:
        '200':
          description: 'Дерево рефералов'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReferralNode'
        '401':
          description: Требуется аутентификация
        '403':
          description: Доступ запрещён
        '404':
          description: Пользователь не найден
  /api/referrals/rewards/:
    get:
      operationId: referrals_rewards_list
      description: 'Получить список начисленных реферальных вознаграждений и агрегированную сводку для текущего пользователя или указанного пользователя (для админа).'
      tags:
        - referrals
      security:
        - MemberTokenAuth: []
      parameters:
        - name: member_id
          in: query
          required: false
          description: 'ID пользователя, для которого нужно получить реферальные вознаграждения (доступно только администраторам).'
          schema:
            type: integer
      responses:
        '200':
          description: 'Реферальные вознаграждения и сводка'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReferralRewardsResponse'
        '401':
          description: Требуется аутентификация
        '403':
          description: Доступ запрещён
        '404':
          description: Пользователь не найден
  /api/referrals/deposits/:
    get:
      operationId: referrals_deposits_list
      description: 'Получить список депозитов, совершённых прямыми рефералами текущего пользователя.'
      tags:
        - referrals
      security:
        - MemberTokenAuth: []
      responses:
        '200':
          description: 'Список депозитов рефералов.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReferralDeposit'
        '401':
          description: Требуется аутентификация
  /api/referrals/bonuses/:
    get:
      operationId: referrals_bonuses_list
      description: 'Получить список бонусов, начисленных текущему пользователю за траты средств его рефералов из кошелька (ReferralBonus).' 
      tags:
        - referrals
      security:
        - MemberTokenAuth: []
      responses:
        '200':
          description: 'Список бонусов за траты рефералов.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReferralBonus'
        '401':
          description: Требуется аутентификация
  /api/referrals/ranks/:
    get:
      operationId: referrals_ranks_list
      description: 'Получить список всех рангов реферальной программы с порогами активных рефералов и множителями глубинного вознаграждения.'
      tags:
        - referrals
      security:
        - MemberTokenAuth: []
      responses:
        '200':
          description: 'Список правил рангов.'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReferralRankRule'
        '401':
          description: Требуется аутентификация
  /api/admin/members/:
    get:
      operationId: admin_members_list
      summary: 'Админ-панель: Все пользователи'
      description: 'Список всех пользователей (Member) для админ-панели.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      responses:
        '200':
          description: Список пользователей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedAdminMemberList'
        '401':
          description: Требуется аутентификация
    post:
      operationId: admin_members_create
      summary: 'Админ-панель: Создать пользователя'
      description: 'Создание нового пользователя (включая инфлюенсеров и администраторов) через админ-панель.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminMemberCreateRequest'
      responses:
        '201':
          description: Пользователь создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminMember'
        '400':
          description: Ошибка валидации данных
        '401':
          description: Требуется аутентификация
  /api/admin/members/{id}/:
    get:
      operationId: admin_members_retrieve
      summary: 'Админ-панель: Детали пользователя'
      description: 'Получить подробную информацию о пользователе для админ-панели.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 'ID пользователя.'
          schema:
            type: integer
      responses:
        '200':
          description: Детали пользователя
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminMember'
        '401':
          description: Требуется аутентификация
        '404':
          description: Пользователь не найден
    patch:
      operationId: admin_members_partial_update
      summary: 'Админ-панель: Частичное обновление пользователя'
      description: 'Изменение контактных данных и флагов is_influencer / is_admin пользователя.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 'ID пользователя.'
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminMember'
      responses:
        '200':
          description: Пользователь обновлён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminMember'
        '400':
          description: Ошибка валидации данных
        '401':
          description: Требуется аутентификация
        '404':
          description: Пользователь не найден
    put:
      operationId: admin_members_update
      summary: 'Админ-панель: Полное обновление пользователя'
      description: 'Полное обновление информации о пользователе (кроме пароля и реферального кода).'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 'ID пользователя.'
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminMember'
      responses:
        '200':
          description: Пользователь обновлён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminMember'
        '400':
          description: Ошибка валидации данных
        '401':
          description: Требуется аутентификация
        '404':
          description: Пользователь не найден
  /api/admin/members/{id}/reset-password/:
    post:
      operationId: admin_members_reset_password_create
      summary: 'Админ-панель: Сброс пароля пользователя'
      description: 'Сбрасывает пароль указанного пользователя. Администратор может передать новый пароль вручную или оставить поле пустым, чтобы система сгенерировала случайный безопасный пароль.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 'ID пользователя, для которого нужно сбросить пароль.'
          schema:
            type: integer
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminResetMemberPasswordRequest'
      responses:
        '200':
          description: 'Пароль пользователя успешно сброшен администратором.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminResetMemberPasswordResponse'
        '400':
          description: 'Ошибка валидации нового пароля.'
        '403':
          description: 'Доступ запрещён (недостаточно прав администратора).'
        '404':
          description: 'Пользователь не найден.'
  /api/admin/referrals/:
    get:
      operationId: admin_referrals_list
      summary: 'Админ-панель: Все реферальные события (депозиты)'
      description: 'Список всех реферальных событий (депозитов) с возможностью фильтрации по пользователю, типу (инфлюенсер/обычный) и диапазону дат. Каждое событие отражает конкретный депозит/стек/ребай с полем deposit_amount.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      parameters:
        - name: referrer_id
          in: query
          required: false
          description: 'Фильтр по ID пользователя-реферера.'
          schema:
            type: integer
        - name: is_influencer
          in: query
          required: false
          description: 'Фильтр по типу реферера: инфлюенсер (true) или обычный пользователь (false).'
          schema:
            type: boolean
        - name: from_date
          in: query
          required: false
          description: 'Начальная дата диапазона (YYYY-MM-DD) для фильтрации по дате создания.'
          schema:
            type: string
            format: date
        - name: to_date
          in: query
          required: false
          description: 'Конечная дата диапазона (YYYY-MM-DD) для фильтрации по дате создания.'
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Список реферальных событий
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedReferralEventAdminList'
        '401':
          description: Требуется аутентификация
    post:
      operationId: admin_referrals_create
      summary: 'Админ-панель: Создать реферальное событие (депозит)'
      description: 'Создаёт реферальное событие, фиксирующее депозит приведённого игрока (первый визит или последующие пополнения) и автоматически рассчитывает многоуровневые вознаграждения по ранговой системе: бонус за первый турнир/депозит и 10% со всех дальнейших депозитов для инфлюенсеров.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminCreateReferralEventRequest'
      responses:
        '201':
          description: Реферальное событие создано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReferralEventAdmin'
        '400':
          description: Ошибка валидации данных
        '401':
          description: Требуется аутентификация
  /api/admin/stats/overview/:
    get:
      operationId: admin_stats_overview_retrieve
      summary: 'Админ-панель: Общая статистика'
      description: 'Общая статистика для админ-панели: Регистрации по дням, Топ рефереров, Доход по источникам.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      responses:
        '200':
          description: Общая статистика для админ-панели
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminStatsOverview'
        '401':
          description: Требуется аутентификация
  /api/admin/wallet/debit/:
    post:
      operationId: admin_wallet_debit_create
      summary: 'Админ-панель: Списание средств с баланса пользователя'
      description: 'Администратор вручную списывает средства с кошелька пользователя. Операция выполняется атомарно, проверяется достаточность баланса, создаётся запись WalletTransaction с типом admin_debit.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminWalletDebitRequest'
      responses:
        '201':
          description: 'Операция списания успешно создана.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletTransaction'
        '400':
          description: 'Ошибка валидации данных (например, неположительная сумма или недостаточно средств на балансе пользователя).'
        '401':
          description: 'Требуется аутентификация.'
        '403':
          description: 'Доступ запрещён (недостаточно прав администратора).'
  /api/admin/wallet/deposit/:
    post:
      operationId: admin_wallet_deposit_create
      summary: 'Админ-панель: Пополнение баланса пользователя'
      description: 'Администратор вручную пополняет кошелёк пользователя. Создаётся транзакция WalletTransaction с типом deposit и пометкой источника admin_deposit.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminWalletDepositRequest'
      responses:
        '201':
          description: 'Операция пополнения успешно создана.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletTransaction'
        '400':
          description: 'Ошибка валидации данных (например, неположительная сумма).'
        '401':
          description: 'Требуется аутентификация.'
        '403':
          description: 'Доступ запрещён (недостаточно прав администратора).'
  /api/admin/wallet/spend/:
    post:
      operationId: admin_wallet_spend_create
      summary: 'Админ-панель: Симуляция списания средств с баланса пользователя'
      description: 'Администратор моделирует списание средств с кошелька пользователя. Такое списание создаёт транзакцию типа spend и запускает стандартную логику реферальных бонусов.'
      tags:
        - admin
      security:
        - MemberTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminWalletSpendRequest'
      responses:
        '201':
          description: 'Операция списания успешно создана.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WalletTransaction'
        '400':
          description: 'Ошибка валидации данных (например, неположительная сумма или недостаточно средств на кошельке пользователя).'
        '401':
          description: 'Требуется аутентификация.'
        '403':
          description: 'Доступ запрещён (недостаточно прав администратора).'
components:
  schemas:
    Message:
      type: object
      properties:
        message:
          type: string
          maxLength: 200
        timestamp:
          type: string
          format: date-time
          readOnly: true
      required:
        - message
        - timestamp
    MemberReferrer:
      type: object
      description: 'Краткая информация о реферере.'
      properties:
        id:
          type: integer
          description: 'Идентификатор пользователя.'
        first_name:
          type: string
          description: 'Имя пользователя.'
        last_name:
          type: string
          description: 'Фамилия пользователя.'
        phone:
          type: string
          description: 'Номер телефона пользователя.'
        referral_code:
          type: string
          description: 'Реферальный код пользователя.'
      required:
        - id
        - first_name
        - last_name
        - phone
        - referral_code
    Deposit:
      type: object
      description: 'Запись о депозите пользователя.'
      properties:
        id:
          type: integer
          description: 'Идентификатор депозита.'
        amount:
          type: string
          format: decimal
          description: 'Сумма депозита в рублях.'
        currency:
          type: string
          description: 'Валюта депозита (по умолчанию RUB).'
        is_test:
          type: boolean
          description: 'Является ли депозит тестовым (демонстрационным).'
        created_at:
          type: string
          format: date-time
          description: 'Дата и время создания депозита.'
      required:
        - id
        - amount
        - currency
        - is_test
        - created_at
    ReferralDeposit:
      type: object
      description: 'Депозит, совершённый рефералом текущего пользователя.'
      properties:
        id:
          type: integer
          description: 'Идентификатор депозита.'
        member:
          allOf:
            - $ref: '#/components/schemas/MemberReferrer'
          description: 'Реферал, который совершил депозит.'
        amount:
          type: string
          format: decimal
          description: 'Сумма депозита в рублях.'
        currency:
          type: string
          description: 'Валюта депозита (по умолчанию RUB).'
        is_test:
          type: boolean
          description: 'Является ли депозит тестовым (демонстрационным).'
        created_at:
          type: string
          format: date-time
          description: 'Дата и время создания депозита.'
      required:
        - id
        - member
        - amount
        - currency
        - is_test
        - created_at
    ReferralBonus:
      type: object
      description: 'Бонус, начисленный рефереру за трату средств рефералом из кошелька.'
      properties:
        id:
          type: integer
          description: 'Идентификатор бонуса.'
        referred_member:
          allOf:
            - $ref: '#/components/schemas/MemberReferrer'
          description: 'Реферал, совершивший трату средств.'
        amount:
          type: string
          format: decimal
          description: 'Сумма бонуса в рублях.'
        spend_transaction_id:
          type: integer
          description: 'ID транзакции кошелька типа SPEND, по которой начислен бонус.'
        spend_amount:
          type: string
          format: decimal
          description: 'Сумма исходной траты средств из кошелька реферала.'
        created_at:
          type: string
          format: date-time
          description: 'Дата и время начисления бонуса.'
      required:
        - id
        - referred_member
        - amount
        - spend_transaction_id
        - spend_amount
        - created_at
    Member:
      type: object
      description: 'Пользователь сервиса (Member) с полями ранговой реферальной системы и кошельком.'
      properties:
        id:
          type: integer
          description: 'Идентификатор пользователя.'
        first_name:
          type: string
          description: 'Имя пользователя.'
        last_name:
          type: string
          description: 'Фамилия пользователя.'
        phone:
          type: string
          description: 'Номер телефона, используемый для входа.'
        email:
          type: string
          format: email
          nullable: true
          description: 'Электронная почта пользователя.'
        is_influencer:
          type: boolean
          description: 'Является ли пользователь инфлюенсером (legacy-флаг).'
        is_admin:
          type: boolean
          description: 'Является ли пользователь администратором.'
        referral_code:
          type: string
          description: 'Уникальный реферальный код пользователя.'
        referred_by:
          allOf:
            - $ref: '#/components/schemas/MemberReferrer'
          nullable: true
          description: 'Пользователь, который привёл данного участника.'
        created_at:
          type: string
          format: date-time
          description: 'Дата и время регистрации пользователя.'
        user_type:
          type: string
          description: 'Тип пользователя в ранговой системе: "player" (игрок) или "influencer" (инфлюенсер).'
          enum:
            - player
            - influencer
        rank:
          type: string
          description: 'Текущий ранг пользователя в реферальной программе.'
          enum:
            - standard
            - silver
            - gold
            - platinum
        v_coins_balance:
          type: string
          format: decimal
          description: 'Баланс виртуальных фишек (V-Coins) пользователя.'
        cash_balance:
          type: string
          format: decimal
          description: 'Текущий денежный баланс пользователя в рублях (источником служит поле cash_balance в модели Member).'
        wallet_balance:
          type: string
          format: decimal
          description: 'Текущий баланс кошелька пользователя (денежные средства внутри приложения, алиас cash_balance).'
        wallet_total_deposited:
          type: string
          format: decimal
          description: 'Суммарный объём пополнений кошелька пользователя (агрегировано по WalletTransaction с типом deposit).'
        wallet_total_spent:
          type: string
          format: decimal
          description: 'Суммарный объём трат и выводов из кошелька пользователя (агрегировано по WalletTransaction с типом spend/withdraw).'
        direct_referrals_count:
          type: integer
          description: 'Количество прямых рефералов (уровень 1) в ранговой системе (основано на ReferralRelation).'
        active_direct_referrals_count:
          type: integer
          description: 'Количество активных прямых рефералов (уровень 1), для которых уже начислен бонус за первый турнир/депозит.'
        current_rank_rule:
          allOf:
            - $ref: '#/components/schemas/RankRuleSummary'
          nullable: true
          description: 'Порог и множители глубинного кэшбэка для текущего ранга пользователя.'
        withdrawal_bank_details:
          type: string
          nullable: true
          description: 'Реквизиты банковской карты/счёта для вывода средств (видит только владелец аккаунта и администратор).'
        withdrawal_crypto_wallet:
          type: string
          nullable: true
          description: 'Адрес криптовалютного кошелька для вывода средств (видит только владелец аккаунта и администратор).'
        total_deposits:
          type: string
          format: decimal
          description: 'Суммарный объём депозитов пользователя (включая тестовые), в рублях.'
        total_influencer_earnings:
          type: string
          format: decimal
          description: 'Общая сумма реферальных вознаграждений инфлюенсера в рублях.'
        deposits:
          type: array
          description: 'Список депозитов пользователя (последние сначала).'
          items:
            $ref: '#/components/schemas/Deposit'
        referred_members_count:
          type: integer
          description: 'Количество игроков, приглашённых данным пользователем (прямые рефералы 1-го уровня).'
        available_for_withdrawal:
          type: string
          format: decimal
          description: 'Доступная для вывода сумма инфлюенсерских вознаграждений с учётом уже созданных заявок на вывод.'
        last_withdrawal_request:
          allOf:
            - $ref: '#/components/schemas/WithdrawalRequest'
          nullable: true
          description: 'Последняя созданная заявка на вывод средств для пользователя (если есть).'
      required:
        - id
        - first_name
        - last_name
        - phone
        - is_influencer
        - is_admin
        - referral_code
        - created_at
        - user_type
        - rank
        - v_coins_balance
        - cash_balance
        - wallet_balance
        - wallet_total_deposited
        - wallet_total_spent
        - direct_referrals_count
        - active_direct_referrals_count
        - total_deposits
        - total_influencer_earnings
        - deposits
        - referred_members_count
        - available_for_withdrawal
    RankRuleSummary:
      type: object
      description: 'Правило ранга: порог активных рефералов и множители глубинного бонуса.'
      properties:
        required_referrals:
          type: integer
          description: 'Количество активных рефералов 1-го уровня, необходимых для достижения ранга.'
        player_depth_bonus_multiplier:
          type: string
          format: decimal
          description: 'Множитель глубинного кэшбэка для игроков (V-Coins) для данного ранга.'
        influencer_depth_bonus_multiplier:
          type: string
          format: decimal
          description: 'Множитель глубинного кэшбэка для инфлюенсеров (рубли) для данного ранга.'
      required:
        - required_referrals
        - player_depth_bonus_multiplier
        - influencer_depth_bonus_multiplier
    ReferralRankRule:
      type: object
      description: 'Полное правило ранга реферальной программы.'
      properties:
        rank:
          type: string
          description: 'Идентификатор ранга.'
          enum:
            - standard
            - silver
            - gold
            - platinum
        required_referrals:
          type: integer
          description: 'Количество активных рефералов 1-го уровня, необходимых для достижения ранга.'
        player_depth_bonus_multiplier:
          type: string
          format: decimal
          description: 'Множитель глубинного кэшбэка для игроков (V-Coins) для данного ранга.'
        influencer_depth_bonus_multiplier:
          type: string
          format: decimal
          description: 'Множитель глубинного кэшбэка для инфлюенсеров (рубли) для данного ранга.'
      required:
        - rank
        - required_referrals
        - player_depth_bonus_multiplier
        - influencer_depth_bonus_multiplier
    RegistrationRequest:
      type: object
      description: 'Данные для регистрации нового пользователя.'
      properties:
        first_name:
          type: string
          description: 'Имя.'
        last_name:
          type: string
          description: 'Фамилия.'
        phone:
          type: string
          description: 'Номер телефона, который будет использоваться для входа.'
        email:
          type: string
          format: email
          nullable: true
          description: 'Электронная почта (необязательно).'
        password:
          type: string
          format: password
          description: 'Пароль (минимум 6 символов).'
        referral_code:
          type: string
          nullable: true
          description: 'Реферальный код пригласившего пользователя (необязательно).'
      required:
        - first_name
        - last_name
        - phone
        - password
    RegistrationResponse:
      type: object
      description: 'Ответ при успешной регистрации.'
      properties:
        member:
          $ref: '#/components/schemas/Member'
        token:
          type: string
          description: 'Токен аутентификации пользователя (используется в заголовке Authorization: Token <ключ>).'
      required:
        - member
        - token
    LoginRequest:
      type: object
      description: 'Данные для авторизации пользователя.'
      properties:
        phone:
          type: string
          description: 'Номер телефона.'
        password:
          type: string
          format: password
          description: 'Пароль.'
      required:
        - phone
        - password
    LoginResponse:
      type: object
      description: 'Ответ при успешной авторизации.'
      properties:
        member:
          $ref: '#/components/schemas/Member'
        token:
          type: string
          description: 'Токен аутентификации пользователя (используется в заголовке Authorization: Token <ключ>).'
      required:
        - member
        - token
    ChangePasswordRequest:
      type: object
      description: 'Данные для смены пароля текущего авторизованного пользователя.'
      properties:
        old_password:
          type: string
          format: password
          description: 'Текущий пароль пользователя.'
        new_password:
          type: string
          format: password
          description: 'Новый пароль (минимум 6 символов).'
      required:
        - old_password
        - new_password
    ChangePasswordResponse:
      type: object
      description: 'Ответ при успешной смене пароля.'
      properties:
        detail:
          type: string
          description: 'Сообщение об успешной смене пароля.'
      required:
        - detail
    PasswordResetRequestRequest:
      type: object
      description: 'Данные для запроса одноразового кода сброса пароля.'
      properties:
        email:
          type: string
          format: email
          nullable: true
          description: 'Электронная почта пользователя (можно не указывать, если задан телефон).'
        phone:
          type: string
          nullable: true
          description: 'Номер телефона пользователя (можно не указывать, если задан email).'
      required: []
    PasswordResetRequestResponse:
      type: object
      description: 'Ответ при успешном запросе кода сброса пароля.'
      properties:
        detail:
          type: string
          description: 'Текстовое сообщение о том, что код для смены пароля отправлен.'
        dev_code:
          type: string
          description: 'Только для окружения разработки: одноразовый код сброса пароля.'
      required:
        - detail
        - dev_code
    PasswordResetConfirmRequest:
      type: object
      description: 'Данные для подтверждения кода сброса и установки нового пароля.'
      properties:
        email:
          type: string
          format: email
          nullable: true
        phone:
          type: string
          nullable: true
        code:
          type: string
          description: 'Одноразовый код сброса пароля.'
        new_password:
          type: string
          format: password
          description: 'Новый пароль (минимум 6 символов).'
      required:
        - code
        - new_password
    PasswordResetConfirmResponse:
      type: object
      description: 'Ответ при успешном сбросе пароля.'
      properties:
        detail:
          type: string
          description: 'Сообщение об успешном сбросе пароля.'
      required:
        - detail
    ReferralHistoryItem:
      type: object
      description: 'Элемент истории начислений по реферальной программе.'
      properties:
        date:
          type: string
          format: date
        referred_name:
          type: string
        bonus_amount:
          type: integer
        money_amount:
          type: integer
      required:
        - date
        - referred_name
        - bonus_amount
        - money_amount
    RegistrationsChartPoint:
      type: object
      description: 'Точка на графике регистраций по дням.'
      properties:
        date:
          type: string
          format: date
        count:
          type: integer
      required:
        - date
        - count
    PlayerDepositHistoryItem:
      type: object
      description: 'Элемент истории собственных депозитов игрока.'
      properties:
        date:
          type: string
          format: date
        amount:
          type: integer
      required:
        - date
        - amount
    LevelSummaryItem:
      type: object
      description: 'Сводка по уровню глубины: всего и активных рефералов.'
      properties:
        level:
          type: integer
          description: 'Уровень глубины (1 — прямые рефералы).'
        total_referrals:
          type: integer
          description: 'Общее количество рефералов на этом уровне.'
        active_referrals:
          type: integer
          description: 'Количество активных рефералов на этом уровне (has_paid_first_bonus=true).'
      required:
        - level
        - total_referrals
        - active_referrals
    ProfileStats:
      type: object
      description: 'Статистика реферальной программы для профиля пользователя.'
      properties:
        total_referrals:
          type: integer
        active_referrals:
          type: integer
        total_bonus_points:
          type: integer
        total_money_earned:
          type: integer
        history:
          type: array
          items:
            $ref: '#/components/schemas/ReferralHistoryItem'
        registrations_chart:
          type: array
          items:
            $ref: '#/components/schemas/RegistrationsChartPoint'
        my_deposits_total_amount:
          type: integer
        my_deposits_count:
          type: integer
        my_deposits:
          type: array
          items:
            $ref: '#/components/schemas/PlayerDepositHistoryItem'
        referral_total_deposits_amount:
          type: integer
        referral_total_bonuses_amount:
          type: integer
        level_summary:
          type: array
          description: 'Сводка по уровням глубины: всего и активных рефералов на каждом уровне.'
          items:
            $ref: '#/components/schemas/LevelSummaryItem'
      required:
        - total_referrals
        - active_referrals
        - total_bonus_points
        - total_money_earned
        - history
        - registrations_chart
        - my_deposits_total_amount
        - my_deposits_count
        - my_deposits
        - referral_total_deposits_amount
        - referral_total_bonuses_amount
        - level_summary
    ReferralNode:
      type: object
      description: 'Элемент дерева рефералов.'
      properties:
        descendant_id:
          type: integer
        level:
          type: integer
        has_paid_first_bonus:
          type: boolean
        username:
          type: string
        user_type:
          type: string
          enum:
            - player
            - influencer
        rank:
          type: string
          enum:
            - standard
            - silver
            - gold
            - platinum
        is_active_referral:
          type: boolean
      required:
        - descendant_id
        - level
        - has_paid_first_bonus
        - username
        - user_type
        - rank
        - is_active_referral
    ReferralReward:
      type: object
      description: 'Запись о начисленном реферальном вознаграждении.'
      properties:
        id:
          type: integer
        reward_type:
          type: string
        amount_rub:
          type: string
          format: decimal
        stack_count:
          type: integer
        depth:
          type: integer
        created_at:
          type: string
          format: date-time
        source_member:
          type: integer
        source_member_name:
          type: string
      required:
        - id
        - reward_type
        - amount_rub
        - stack_count
        - depth
        - created_at
        - source_member
        - source_member_name
    ReferralRewardsSummary:
      type: object
      description: 'Сводные данные по реферальным вознаграждениям.'
      properties:
        total_stack_count:
          type: integer
        total_influencer_amount:
          type: string
          format: decimal
        total_first_tournament_amount:
          type: string
          format: decimal
        total_deposit_percent_amount:
          type: string
          format: decimal
      required:
        - total_stack_count
        - total_influencer_amount
        - total_first_tournament_amount
        - total_deposit_percent_amount
    ReferralRewardsResponse:
      type: object
      description: 'Ответ с детализацией реферальных вознаграждений и агрегированной сводкой.'
      properties:
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/ReferralReward'
        summary:
          $ref: '#/components/schemas/ReferralRewardsSummary'
      required:
        - rewards
        - summary
    AdminMember:
      type: object
      description: 'Пользователь для отображения и управления в админ-панели.'
      properties:
        id:
          type: integer
          readOnly: true
        first_name:
          type: string
        last_name:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email
          nullable: true
        is_influencer:
          type: boolean
        is_admin:
          type: boolean
        referral_code:
          type: string
          readOnly: true
        referred_by:
          allOf:
            - $ref: '#/components/schemas/MemberReferrer'
          nullable: true
          readOnly: true
        created_at:
          type: string
          format: date-time
          readOnly: true
        total_referrals:
          type: integer
          readOnly: true
        total_bonus_points:
          type: integer
          readOnly: true
        total_money_earned:
          type: integer
          readOnly: true
      required:
        - id
        - first_name
        - last_name
        - phone
        - is_influencer
        - is_admin
        - referral_code
        - created_at
        - total_referrals
        - total_bonus_points
        - total_money_earned
    AdminMemberCreateRequest:
      type: object
      description: 'Данные для создания пользователя через админ-панель.'
      properties:
        first_name:
          type: string
        last_name:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email
          nullable: true
        password:
          type: string
          format: password
        is_influencer:
          type: boolean
        is_admin:
          type: boolean
      required:
        - first_name
        - last_name
        - phone
        - password
    AdminResetMemberPasswordRequest:
      type: object
      description: 'Данные для админского сброса пароля пользователя.'
      properties:
        new_password:
          type: string
          format: password
          nullable: true
      required: []
    AdminResetMemberPasswordResponse:
      type: object
      description: 'Ответ при успешном админском сбросе пароля пользователя.'
      properties:
        detail:
          type: string
        generated_password:
          type: string
      required:
        - detail
        - generated_password
    AdminCreateReferralEventRequest:
      type: object
      description: 'Данные для создания реферального события (депозита) через админ-панель.'
      properties:
        referred_id:
          type: integer
        deposit_amount:
          type: integer
        created_at:
          type: string
          format: date-time
          nullable: true
      required:
        - referred_id
        - deposit_amount
    ReferralEventAdmin:
      type: object
      description: 'Реферальное событие для отображения в админ-панели.'
      properties:
        id:
          type: integer
        referrer:
          type: object
          properties:
            id:
              type: integer
            first_name:
              type: string
            last_name:
              type: string
            is_influencer:
              type: boolean
          required:
            - id
            - first_name
            - last_name
            - is_influencer
        referred:
          type: object
          properties:
            id:
              type: integer
            first_name:
              type: string
            last_name:
              type: string
          required:
            - id
            - first_name
            - last_name
        bonus_amount:
          type: integer
        money_amount:
          type: integer
        deposit_amount:
          type: integer
        created_at:
          type: string
          format: date-time
        referrer_is_influencer:
          type: boolean
      required:
        - id
        - referrer
        - referred
        - bonus_amount
        - money_amount
        - deposit_amount
        - created_at
        - referrer_is_influencer
    AdminStatsRegistrationsByDayItem:
      type: object
      description: 'Количество регистраций по дням для админ-панели.'
      properties:
        date:
          type: string
          format: date
        count:
          type: integer
      required:
        - date
        - count
    AdminStatsTopReferrerItem:
      type: object
      description: 'Элемент списка «Топ рефереров» для админ-панели.'
      properties:
        id:
          type: integer
        first_name:
          type: string
        last_name:
          type: string
        is_influencer:
          type: boolean
        total_referrals:
          type: integer
        total_bonus_points:
          type: integer
        total_money_earned:
          type: integer
      required:
        - id
        - first_name
        - last_name
        - is_influencer
        - total_referrals
        - total_bonus_points
        - total_money_earned
    AdminStatsIncomeBySource:
      type: object
      description: 'Доход по источникам для админ-панели.'
      properties:
        total_income:
          type: integer
        income_from_influencers:
          type: integer
        income_from_regular_users:
          type: integer
      required:
        - total_income
        - income_from_influencers
        - income_from_regular_users
    AdminStatsOverview:
      type: object
      description: 'Общая статистика для админ-панели.'
      properties:
        registrations_by_day:
          type: array
          items:
            $ref: '#/components/schemas/AdminStatsRegistrationsByDayItem'
        top_referrers:
          type: array
          items:
            $ref: '#/components/schemas/AdminStatsTopReferrerItem'
        income_by_source:
          $ref: '#/components/schemas/AdminStatsIncomeBySource'
      required:
        - registrations_by_day
        - top_referrers
        - income_by_source
    AdminWalletDebitRequest:
      type: object
      description: 'Данные для админского списания средств с кошелька пользователя.'
      properties:
        member_id:
          type: integer
          description: 'ID пользователя, с кошелька которого нужно списать средства.'
        amount:
          type: string
          format: decimal
          description: 'Сумма списания в рублях.'
        reason:
          type: string
          nullable: true
          description: 'Необязательное описание причины списания.'
      required:
        - member_id
        - amount
    AdminWalletDepositRequest:
      type: object
      description: 'Данные для админского пополнения кошелька пользователя.'
      properties:
        member_id:
          type: integer
          description: 'ID пользователя, чей кошелёк нужно пополнить.'
        amount:
          type: string
          format: decimal
          description: 'Сумма пополнения в рублях. Должна быть положительной.'
        reason:
          type: string
          nullable: true
          description: 'Необязательное текстовое описание причины пополнения.'
      required:
        - member_id
        - amount
    AdminWalletSpendRequest:
      type: object
      description: 'Данные для админской симуляции списания средств с кошелька пользователя.'
      properties:
        member_id:
          type: integer
          description: 'ID пользователя, с кошелька которого моделируется списание.'
        amount:
          type: string
          format: decimal
          description: 'Сумма списания в рублях. Должна быть положительной.'
        description:
          type: string
          nullable: true
          description: 'Необязательное описание операции (например, за что было списание).'
        category:
          type: string
          nullable: true
          description: 'Необязательная категория списания (игра, клуб и т.п.).'
      required:
        - member_id
        - amount
    PaginatedAdminMemberList:
      type: object
      description: 'Страница списка пользователей для админ-панели.'
      properties:
        count:
          type: integer
        next:
          type: string
          format: uri
          nullable: true
        previous:
          type: string
          format: uri
          nullable: true
        results:
          type: array
          items:
            $ref: '#/components/schemas/AdminMember'
      required:
        - count
        - results
    PaginatedReferralEventAdminList:
      type: object
      description: 'Страница списка реферальных событий для админ-панели.'
      properties:
        count:
          type: integer
        next:
          type: string
          format: uri
          nullable: true
        previous:
          type: string
          format: uri
          nullable: true
        results:
          type: array
          items:
            $ref: '#/components/schemas/ReferralEventAdmin'
      required:
        - count
        - results
    MeUpdateRequest:
      type: object
      description: 'Данные для обновления профиля текущего пользователя и реквизитов вывода.'
      properties:
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
          format: email
          nullable: true
        withdrawal_bank_details:
          type: string
          nullable: true
        withdrawal_crypto_wallet:
          type: string
          nullable: true
      required: []
    WithdrawalRequest:
      type: object
      description: 'Заявка пользователя на вывод средств.'
      properties:
        id:
          type: integer
        amount:
          type: string
          format: decimal
        method:
          type: string
          enum:
            - card
            - crypto
        destination:
          type: string
        status:
          type: string
          enum:
            - pending
            - approved
            - rejected
            - paid
        created_at:
          type: string
          format: date-time
        processed_at:
          type: string
          format: date-time
          nullable: true
      required:
        - id
        - amount
        - method
        - destination
        - status
        - created_at
    WithdrawalRequestCreateRequest:
      type: object
      description: 'Данные для создания заявки на вывод средств.'
      properties:
        amount:
          type: string
          format: decimal
        method:
          type: string
          enum:
            - card
            - crypto
        destination:
          type: string
      required:
        - amount
        - method
        - destination
    WalletTransaction:
      type: object
      description: 'Запись операции кошелька пользователя.'
      properties:
        id:
          type: integer
        type:
          type: string
          enum:
            - deposit
            - spend
            - withdraw
            - refund
            - adjustment
            - admin_debit
            - bonus
        amount:
          type: string
          format: decimal
        balance_after:
          type: string
          format: decimal
        description:
          type: string
          nullable: true
        meta:
          type: object
          nullable: true
          additionalProperties: true
        created_at:
          type: string
          format: date-time
      required:
        - id
        - type
        - amount
        - balance_after
        - created_at
    WalletSummary:
      type: object
      description: 'Сводная информация по кошельку пользователя.'
      properties:
        balance:
          type: string
          format: decimal
        total_deposited:
          type: string
          format: decimal
        total_spent:
          type: string
          format: decimal
      required:
        - balance
        - total_deposited
        - total_spent
    WalletDepositRequest:
      type: object
      description: 'Данные для внутреннего пополнения кошелька.'
      properties:
        amount:
          type: string
          format: decimal
        description:
          type: string
          nullable: true
      required:
        - amount
    WalletSpendRequest:
      type: object
      description: 'Данные для списания средств из кошелька.'
      properties:
        amount:
          type: string
          format: decimal
        description:
          type: string
          nullable: true
        category:
          type: string
          nullable: true
      required:
        - amount
    PaginatedWalletTransactionList:
      type: object
      description: 'Страница списка операций кошелька.'
      properties:
        count:
          type: integer
        next:
          type: string
          format: uri
          nullable: true
        previous:
          type: string
          format: uri
          nullable: true
        results:
          type: array
          items:
            $ref: '#/components/schemas/WalletTransaction'
      required:
        - count
        - results
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
    cookieAuth:
      type: apiKey
      in: cookie
      name: sessionid
    MemberTokenAuth:
      type: apiKey
      in: header
      name: Authorization
      description: 'Используйте формат: `Token <ключ>` для аутентификации пользователя.'
